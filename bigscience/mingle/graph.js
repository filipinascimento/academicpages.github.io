(function(){function s(a){var b={},c;for(c in a)b[c]={value:a[c],writable:!0,enumerable:!0,configurable:!0};return b}function m(a,b){return Object.create(a,s(b))}function t(a,b){var c;for(c in b)a[c]=b[c]}var h=function(a){this.opt=m({node:{}},a||{}),this.nodes={},this.edges={}};h.fromJSON=function(a){var b=a.nodes,c=a.edges,d=h.Node,e=h.Edge,f=new h(),g;for(g in b)b[g]=d.fromJSON(b[g]);f.nodes=b;for(g in c)c[g]=e.fromJSON(f,c[g]);return f.edges=c,f},h.prototype={clear:function(){this.nodes={},this.edges={}},toJSON:function(){var a=[],b=[],c=this.nodes,d=this.edges,e,f,g;for(e in c)a.push(c[e].toJSON());for(f in d)for(g in d[f])b.push(d[f][g].toJSON());return{nodes:a,edges:b}},getNode:function(a){return this.hasNode(a)?this.nodes[a]:!1},get:function(a){return this.getNode(a)},getByName:function(a){for(var b in this.nodes){var c=this.nodes[b];if(c.name==a)return c}return!1},getEdge:function(a,b){return a in this.edges?this.edges[a][b]:!1},addNode:function(a){if(!this.nodes[a.id]){var b=this.edges[a.id]={};this.nodes[a.id]=new h.Node(m({id:a.id,name:a.name,data:m(a.data||{},{}),adjacencies:b},this.opt.node))}return this.nodes[a.id]},addEdge:function(a,b,c){this.hasNode(a.id)||this.addNode(a),this.hasNode(b.id)||this.addNode(b),a=this.nodes[a.id],b=this.nodes[b.id];if(!a.adjacentTo(b)){var d=this.edges[a.id]=this.edges[a.id]||{},e=this.edges[b.id]=this.edges[b.id]||{};return d[b.id]=e[a.id]=new h.Edge(a,b,c,this.Edge,this.Label),d[b.id]}return this.edges[a.id][b.id]},removeNode:function(a){if(this.hasNode(a)){delete this.nodes[a];var b=this.edges[a];for(var c in b)delete this.edges[c][a];delete this.edges[a]}},removeEdge:function(a,b){delete this.edges[a][b],delete this.edges[b][a]},hasNode:function(a){return a in this.nodes},empty:function(){this.nodes={},this.edges={}}},h.Node=function(a){var b={id:"",name:"",data:{},adjacencies:{}};t(this,m(b,a))},h.Node.fromJSON=function(a){return new h.Node(a)},h.Node.prototype={toJSON:function(){return{id:this.id,name:this.name,data:this.serializeData(this.data)}},serializeData:function(a){var b={},c=a.parents,d,e,f;if(c)for(d=Array(c.length),e=0,f=c.length;e<f;++e)d[e]=c[e].toJSON();for(e in a)b[e]=a[e];return delete b.parents,delete b.bundle,b=JSON.parse(JSON.stringify(b)),d&&(b.parents=d),b},adjacentTo:function(a){return a.id in this.adjacencies},getEdge:function(a){return this.adjacencies[a]},toString:function(){return"Node("+JSON.stringify([this.id,this.name,this.data,this.adjacencies])+")"}},h.Edge=function(a,b,c){this.nodeFrom=a,this.nodeTo=b,this.data=c||{}},h.Edge.fromJSON=function(a,b){return new h.Edge(a.get(b.nodeFrom),a.get(b.nodeTo),b.data)},h.Edge.prototype.toJSON=function(){return{nodeFrom:this.nodeFrom.id,nodeTo:this.nodeTo.id,data:this.data}},h.Util={filter:function(a){if(!a||!(typeof a=="string"))return function(){return!0};var b=a.split(" ");return function(c){for(var d=0;d<b.length;d++)if(c[b[d]])return!1;return!0}},getNode:function(a,b){return a.nodes[b]},eachNode:function(a,b,c){var d=this.filter(c);for(var e in a.nodes)d(a.nodes[e])&&b(a.nodes[e])},each:function(a,b,c){this.eachNode(a,b,c)},eachEdge:function(a,b,c){var d=a.adjacencies,e=this.filter(c);for(var f in d){var g=d[f];if(e(g)){if(g.nodeFrom!=a){var j=g.nodeFrom;g.nodeFrom=g.nodeTo,g.nodeTo=j}b(g,f)}}},computeLevels:function(a,b,c,d){c=c||0;var e=this.filter(d);this.eachNode(a,function(i){i._flag=!1,i.depth=-1},d);var f=a.getNode(b);f.depth=c;for(var g=[f];g.length!=0;){var j=g.pop();j._flag=!0,this.eachEdge(j,function(i){var k=i.nodeTo;k._flag==!1&&e(k)&&!i._hiding&&(k.depth<0&&(k.depth=j.depth+1+c),g.unshift(k))},d)}},eachBFS:function(a,b,c,d){var e=this.filter(d);this.clean(a);for(var f=[a.getNode(b)];f.length!=0;){var g=f.pop();if(!g)return;g._flag=!0,c(g,g.depth),this.eachEdge(g,function(j){var i=j.nodeTo;i._flag==!1&&e(i)&&!j._hiding&&(i._flag=!0,f.unshift(i))},d)}},eachLevel:function(a,b,c,d,e){var f=a.depth,g=this.filter(e),j=this,i=!0;c=c===!1?Number.MAX_VALUE-f:c,function k(n,q,o){if(!i)return;var l=n.depth,p;l>=q&&l<=o&&g(n)&&(p=d(n,l)),typeof p!=="undefined"&&(i=p),i&&l<o&&j.eachEdge(n,function(u){var r=u.nodeTo;r.depth>l&&k(r,q,o)})}(a,b+f,c+f)},eachSubgraph:function(a,b,c){this.eachLevel(a,0,!1,b,c)},eachSubnode:function(a,b,c){this.eachLevel(a,1,1,b,c)},anySubnode:function(a,b,c){var d=!1;b=b||function(){return!0};var e=typeof b=="string"?function(f){return f[b]}:b;return this.eachSubnode(a,function(f){e(f)&&(d=!0)},c),d},getSubnodes:function(a,b,c){var d=[],e=this;b=b||0;var f,g;return Array.isArray(b)=="array"?(f=b[0],g=b[1]):(f=b,g=Number.MAX_VALUE-a.depth),this.eachLevel(a,f,g,function(j){d.push(j)},c),d},getParents:function(a){var b=[];return this.eachEdge(a,function(c){var d=c.nodeTo;d.depth<a.depth&&b.push(d)}),b},isDescendantOf:function(a,b){if(a.id==b)return!0;for(var c=this.getParents(a),d=!1,e=0;!d&&e<c.length;e++)d=d||this.isDescendantOf(c[e],b);return d},clean:function(a){this.eachNode(a,function(b){b._flag=!1})}},["get","getNode","each","eachNode","computeLevels","eachBFS","clean"].forEach(function(a){h.prototype[a]=function(){return h.Util[a].apply(h.Util,[this].concat(Array.prototype.slice.call(arguments)))}}),["eachEdge","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"].forEach(function(a){h.Node.prototype[a]=function(){return h.Util[a].apply(h.Util,[this].concat(Array.prototype.slice.call(arguments)))}}),window.Graph=h})();
